develop_code_task:
  description: >
    Você é um Desenvolvedor Senior. Gere o código Python para um dashboard Streamlit.
    
    Dados: {data_summary}
    Pedido do Usuário: {user_request}
    Arquivo: '{file_path}'
    
    REGRAS DE CODIFICAÇÃO:
    1. Crie filtros interativos (st.multiselect) para colunas categóricas.
    2. Crie 2 ou 3 gráficos Altair interessantes (ex: Temporal e Categórico).
    3. Use 'pd.read_csv(r"{file_path}")'.
    4. NÃO use '@st.cache' ou 'st.set_page_config'.
    5. NÃO explique nada, apenas gere o código.
    6. MAPAS: Só crie mapas se existirem colunas explícitas de 'Latitude' 
    e 'Longitude'. Use 'st.map(df)' para isso. Se não tiver lat/lon, use gráfico de barras.
  expected_output: >
    Apenas o código Python válido.

create_narrative_task:
  description: >
    Você é um Arquiteto de Dados.
    ANALISE O CÓDIGO PYTHON GERADO PELA TAREFA ANTERIOR.
    
    Com base nos gráficos que o desenvolvedor criou no código, gere o relatório da Gramática dos Gráficos.
    
    ESTRUTURA DA ANÁLISE (Markdown):
    **1. Dados:** Quais colunas foram usadas no código?
    **2. Transformações:** O código faz filtros ou agrupa dados?
    **3. Mapeamentos:** O que está no eixo X, Y e Cor (encode)?
    **4. Marcas:** Qual 'mark_' foi usado (bar, line, circle)?
    **5. Avaliação:** O gráfico escolhido faz sentido para os dados?

    ---
    REGRAS DE SAÍDA CRÍTICAS (MONTAGEM FINAL):
    Você deve retornar UMA única string combinando sua análise e o código original.
    
    Formato:
    [Sua Análise da Gramática dos Gráficos]
    |||SEP|||
    [O CÓDIGO PYTHON ORIGINAL QUE VOCÊ RECEBEU DO CONTEXTO]
    
    IMPORTANTE: Você PRECISA copiar e colar o código Python exato que recebeu da tarefa anterior após o separador.
  expected_output: >
    Análise Gramatical |||SEP||| Código Python Original.

append_chart_task:
  description: >
    Você é um Desenvolvedor Senior em Manutenção de Código.
    
    INPUTS:
    1. Código Python Atual:
    {current_code}
    
    2. Novo Pedido do Usuário: 
    {user_request}
    
    OBJETIVO:
    Adicione o novo gráfico solicitado ao código existente SEM remover nada do que já está lá.
    
    REGRAS DE ENGENHARIA:
    1. Analise o código atual e descubra qual é o nome da variável do DataFrame filtrado (geralmente 'df_filtered' ou similar). Use ELA para o novo gráfico.
    2. NÃO crie novos filtros se eles já existirem. Aproveite os filtros da sidebar/topo.
    3. Adicione o novo gráfico no final do script, preferencialmente dentro de um 'st.expander("Nova Visualização")' ou uma nova 'st.container'.
    4. Mantenha todos os imports e funções de carregamento originais.
    
    SAÍDA:
    Retorne o Código Python COMPLETO e ATUALIZADO (Código Antigo + Novo Gráfico).
  expected_output: >
    Apenas o Código Python Completo.

append_chart_task:
  description: >
    Você é um Especialista em Manutenção de Código.
    
    INPUTS:
    1. Código Atual: {current_code}
    2. Pedido (Novo Gráfico): {user_request}
    
    OBJETIVO:
    Adicione o novo gráfico ao código existente.
    
    REGRAS:
    1. IDIOMA: Títulos e eixos em Português.
    2. ZOOM: Adicione `.interactive()` no novo gráfico.
    3. Use o DataFrame filtrado já existente no código.
    4. Adicione o novo gráfico no final do script dentro de um container ou expander.
    
    SAÍDA:
    Retorne APENAS o Código Python COMPLETO e ATUALIZADO.
  expected_output: >
    Apenas o Código Python Completo.